<section class="saju-form-section">
	<h2>사주풀이</h2>
	<p class="section-desc">생년월일과 시간을 입력하면 당신의 사주를 분석해드립니다.</p>
	<%
		function normalizeTargetLabel(label) {
			const raw = String(label || '').trim();
			if (!raw) return raw;
			const map = {
				SPOUSE: '배우자',
				PARENT: '부모',
				GRANDPARENT: '조부모',
				SON: '아들',
				DAUGHTER: '딸',
				SIBLING: '형제자매',
				FAMILY: '가족',
				FRIEND: '친구',
				OTHER: '기타',
			};
			const parts = raw.split('·');
			if (parts.length < 2) {
				const onlyCode = map[raw.toUpperCase()];
				return onlyCode || raw;
			}
			const relationCode = String(parts[0] || '').trim().toUpperCase();
			const name = String(parts.slice(1).join('·') || '').trim();
			const relationLabel = map[relationCode] || parts[0].trim();
			return `${relationLabel} · ${name}`;
		}
	%>

	<form id="sajuForm" method="POST" data-action="/api/saju/request">
		<div class="form-group">
			<label for="sajuTarget">대상 선택</label>
			<div class="target-select-row">
				<select id="sajuTarget" name="sajuTarget">
					<option value="">새로 보기(직접 입력)</option>
					<% (sajuTargets || []).forEach(function(target) { %>
						<option value="<%= String(target.id) %>"><%= normalizeTargetLabel(target.label) %></option>
					<% }); %>
				</select>
				<a class="btn-manage-relative" href="<%= user ? '/user/mypage/relatives' : '/user/login' %>">지인관리하기</a>
			</div>
		</div>

		<input type="hidden" id="relativeId" name="relative_id" value="0">

		<div class="form-group">
			<label for="name">이름</label>
			<input type="text" id="name" name="name" placeholder="이름을 입력하세요" required class="mustInput">
		</div>

		<div class="form-group">
			<label for="counselingType">상담유형</label>
			<select id="counselingType" name="counselingType" required class="mustInput">
				<option value="soft">부드러운 상담</option>
				<option value="balanced" selected>균형 상담</option>
				<option value="insight">통찰 강화</option>
				<option value="direct">직설 상담</option>
				<option value="factbomb">팩트폭격</option>
			</select>
		</div>

		<div class="form-group">
			<label for="birthYear">생년월일</label>
			<div class="date-select-group">
				<select id="birthYear" name="birthYear" required class="mustInput">
					<option value="">년도</option>
				</select>
				<select id="birthMonth" name="birthMonth" required class="mustInput">
					<option value="">월</option>
				</select>
				<select id="birthDay" name="birthDay" required class="mustInput">
					<option value="">일</option>
				</select>
			</div>
		</div>
		
		<div class="form-group">
			<label for="birthTime">태어난 시간</label>
			<select id="birthTime" name="birthTime" required class="mustInput">
				<option value="">시간 선택</option>
				<option value="00:30:00">자시 (23:30~01:30)</option>
				<option value="02:30:00">축시 (01:30~03:30)</option>
				<option value="04:30:00">인시 (03:30~05:30)</option>
				<option value="06:30:00">묘시 (05:30~07:30)</option>
				<option value="08:30:00">진시 (07:30~09:30)</option>
				<option value="10:30:00">사시 (09:30~11:30)</option>
				<option value="12:30:00">오시 (11:30~13:30)</option>
				<option value="14:30:00">미시 (13:30~15:30)</option>
				<option value="16:30:00">신시 (15:30~17:30)</option>
				<option value="18:30:00">유시 (17:30~19:30)</option>
				<option value="20:30:00">술시 (19:30~21:30)</option>
				<option value="22:30:00">해시 (21:30~23:30)</option>
				<option value="99:99:99">모름</option>
			</select>
		</div>
		
		<div class="form-group">
			<label>성별</label>
			<div class="radio-group">
				<label class="radio-label">
					<input type="radio" name="gender" value="male" required class="mustInput">
					<span>남자</span>
				</label>
				<label class="radio-label">
					<input type="radio" name="gender" value="female" class="mustInput">
					<span>여자</span>
				</label>
			</div>
		</div>
		
		<button type="submit" class="btn-submit">사주 보기</button>
	</form>
</section>
<script type="module">
	import { initSajuFormContainer } from '/js/modules/saju_form.js';

	const sajuTargets = <%- JSON.stringify(sajuTargets || []) %>;
	initSajuFormContainer({ sajuTargets });
</script>
